<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Importing and Basic Plotting of Vector Data" />
  <meta name="copyright" content="<span class='footer-right'><a href='../acknowledgements.html'>Acknowledgements</a></span><span class='footer-right'><a href='../index.html'>Course Homepage</a></span><span class='footer-right'>Forum:&nbsp<a href=' https://tinyurl.com/rspatial-scgis19 ' target='_blank'> https://tinyurl.com/rspatial-scgis19 </a></span><span class='footer-subtitle'> Spatial Data Analysis with R </span>"/>
  <meta name="font-size-adjustment" content="2"/>
  <title>Spatial Data Analysis with R SCGIS Conference, 2019</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACkUlEQVQ4jX2SW0jTcRTHTzNyeZlh6lqmm3POdNPC6SxSEzaqafkykOFoIxTDWpKRFV6iQMNLFyMSsQvUW0WORc2WWBmGKEGZXUyz0NrmNmfa1PYgfHsQ1v5oHjgvX875/M45vy/R8mDJ9caxrFIL5CUWJB00Q9n+7Q+l1BetUMuMTL3JpTB0QVnejd1Hu9DQ60G5eQbqB7PIvj0L2bUZ0KZzghWbs0o7Fx3Tc/B6vStm6+g0wrQvIKh2gKKyUxnNSZoO685SC1YDeL1e9Ll+Ia7WCd5pJ4hojQ8g1nViezETYBqZx93BOdwa9jAgsdUT4J6ZQqC6f4GIiLYU9/RzNWYIdU9hd/8rLjN7UGT8DbWROVVMlQsBBWas142DiIikdfbFMF0POIVm2NzM1zwLS+mvcSsnEajpBSv/8RIgucGJ1EYXEs+NwjrlWfUGMee/Y2PFJIJLrFibex8kOsahhCYnUlpnIL1kh9X9/yMKG2yIOOlAsPYnAveZsE75EEQUQLwTwy5Rsxvx9UxApKEPEYY+BiSizA623oaggkdgq4xLKwRLq7i8sy6EFlpg8wNEVwyAd3wAbZ8cPu3CazeCC/sRojYjaL8Jvm8MPWLDBm03A8CveQ9+7RBia4cYU4QfeokwzTOwc6/4OzKXHap/C5ufD0RNo0i4OAZR81dcnnD69Mp3PxBe9GRkuZdFKk7sqTcQ132EpGUMydetSLnpgOSGHVtbxpHU9AX8mkFEG55/ZrjQL1h82V6esPLVh8Sr40i940J6xzzS7s1C0m6HqHEEiTnatgT5gcPijHxltFwhjpRIQpZjBAJ2lFTBFW5TiOPT8mXx6apdcRl5OaJM1Q6hLC9ls3RPTLgok0NELCKiv02kPqt/O1MZAAAAAElFTkSuQmCC" rel="icon" type="image/x-icon" />
  <script language="javascript" type="text/javascript">
  function TriShowHide(shID) {
    shIDspan = shID + "span";
    shIDdiv = shID + "div";
    if (document.getElementById(shIDdiv).style.display != 'block') {
      document.getElementById(shIDdiv).style.display = 'block';
      txtSpan = "&#9660;";
    } else {
      document.getElementById(shIDdiv).style.display = 'none';
      txtSpan = "&#9654;";
    }
    document.getElementById(shIDspan).innerHTML = txtSpan + " ";
  }
  function showHide(shID) {
    if (shID=="soln-show-all") {
      var allAnswerCode = document.getElementsByClassName("answer-code");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'block';
      }
    } else if (shID=="soln-hide-all") {
      var allAnswerCode = document.getElementsByClassName("answer-code");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'none';
      }
    } else if (shID=="hints-show-all") {
      var allAnswerCode = document.getElementsByClassName("hint");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'block';
      }
    } else if (shID=="hints-hide-all") {
      var allAnswerCode = document.getElementsByClassName("hint");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'none';
      }
    } else {
      if (document.getElementById(shID)) {
        if (document.getElementById(shID).style.display != 'block') {
          document.getElementById(shID).style.display = 'block';
        } else {
          document.getElementById(shID).style.display = 'none';
        }
      }
    }
  }
  function CopyToClipboard(containerid) {
  if (document.selection) {
      var range = document.body.createTextRange();
      range.moveToElementText(document.getElementById(containerid));
      range.select().createTextRange();
      document.execCommand("copy");
  } else if (window.getSelection) {
      var range = document.createRange();
      range.selectNode(document.getElementById(containerid));
      window.getSelection().addRange(range);
      document.execCommand("copy");
      // alert("text copied")
  }}
  </script>
  <link href="lib/slidy-2/styles/slidy.css" rel="stylesheet" />
  <script src="lib/slidy-2/scripts/slidy.js"></script>
  <script src="lib/clipboard-1.7.1/clipboard.min.js"></script>
  <link href="lib/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
  <link href="lib/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
  <script src="lib/klippy-0.0.0.9500/js/klippy.min.js"></script>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="..\css\slidy_styles.css" />
  <meta name="duration" content="0" />
</head>
<body>
<div class="slide titlepage">
  <h1 class="title"><span class="course-title">Spatial Data Analysis with R</span><br/><span class="course-subtitle">SCGIS Conference, 2019</span></h1>
  <p class="author">
Importing and Basic Plotting of Vector Data <br/><img src='images/points-lines-polygons256_200x218.png'/>
  </p>
</div>
<div id="geospatial-data" class="slide section level1">
<h1>Geospatial Data</h1>
<script language="javascript" type="text/javascript">w3c_slidy.mouse_click_enabled = false;</script>
<script>
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<h2 id="physical-world-gis-world">Physical World → GIS World</h2>
<p><img src="./images/geospatial_layers_490x456.png" /></p>
</div>
<div id="projections" class="slide section level1">
<h1>Projections</h1>
<p><img src="./images/projection_800x350.png" /></p>
<div class="centerblock" style="margin-top:2em;">
<iframe src="http://www.jasondavies.com/maps/transition/" style="width:1234px;height:732px;">
<p>
Your browser does not support iframes.
</p>
</iframe>
</div>
<h2 id="utm">UTM</h2>
<p>A common projection system is <strong>Universal Transverse Mercator</strong> (UTM). UTM divides the planet up into 60 zones that are 6 degrees wide. The USA falls in zones 10-19.</p>
<div class="centerblock">
<a href="https://commons.wikimedia.org/wiki/File:Utm-zones-USA.svg"><img src="./images/utm-zones-use_640x480.png"></img></a>
</div>
</div>
<div id="sf-package" class="slide section level1">
<h1>sf Package</h1>
<p><tt><strong>sf</strong></tt> is a relatively new package for working with vector data. It combines the functionality of the older <tt><strong>sp</strong></tt> package, as well as select functionality from <tt><strong>rgdal</strong></tt> and <tt><strong>rgeos</strong></tt>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(sf)</a></code></pre></div>
<p><tt>sf</tt> stands for ‘simple features’, which is a standard (developed by the Open Geospatial Consortium) for storing various geometry types in a hierarchical data model.</p>
<p>A ‘feature’ is just a representation of a thing in the real world (e.g. a building, a city…).</p>
<p><tt>sf</tt> offers numerous specific benefits, including:</p>
<div class="indented1">
<ul>
<li>fast IO (Input and Output)<br />
</li>
<li>enhanced plotting<br />
</li>
<li>excellent integration with common R data structures (using data.frames)<br />
</li>
<li>integration with the tidyverse packages and %&gt;% piping syntax<br />
</li>
<li>consistent function names (all starting with st_)<br />
</li>
<li>objects are supported by an increasing number of other geospatial packages<br />
</li>
<li>alignment with other software that uses the simple features data model (e.g. QGIS, PostGIS), or an analogous one (e.g. Python’s Geopandas)<br />
</li>
</ul>
</div>
</div>
<div id="importing-vector-data" class="slide section level1">
<h1>Importing Vector Data</h1>
<h2 id="sources-and-layers">Sources and Layers</h2>
<p>To import spatial data, you have to specify the <strong>source</strong> and <strong>layer</strong>.</p>
<p>Sources can be a:</p>
<div class="indented1">
<p><strong>folder</strong>: <tt><em>"./gis_data"</em></tt></p>
<p><strong>geodatabase</strong> (which is really a folder): <tt><em>"./gis_data/yose_roads.gdb"</em></tt></p>
<p><strong>file</strong>: <tt><em>"trail_heads.kml"</em></tt></p>
<p><strong>database connection</strong>: <tt><em>"PG:dbname=postgis"</em></tt></p>
</div>
<div class="infobox">
<p>In functions, the argument for the source is often named <tt><strong>dsn</strong></tt> (data source name)</p>
</div>
<p>Layers can be a:</p>
<div class="indented1">
<p><strong>Shapefile name</strong> (minus the shp extension)</p>
<p><strong>layer</strong> name in a database</p>
</div>
</div>
<div id="import-functions" class="slide section level1">
<h1>Import Functions</h1>
<p>The two main functions for importing vector data are:</p>
<div class="indented1">
<p><tt><strong>st_layers(<em>source</em>)</strong></tt> <em>returns the names of avilable layers in a source</em></p>
<p><tt><strong>st_read(<em>source</em>, <em>layer</em>)</strong></tt> <em>import into R</em></p>
</div>
<div class="infobox">
<p>Most of the functions in the sf package start with <tt><strong>st_</strong></tt>, which stands for ‘space time’, and matches the names of similar functions in PostGIS.</p>
</div>
</div>
<div id="import-the-boundary-for-yosemite-national-park" class="slide section level1">
<h1>Import the boundary for Yosemite National Park</h1>
<p>Let’s import the Yosemite <a href="../datasets.html#yose_boundary" target="_blank">park boundary</a> (which happens to be a Shapefile).</p>
<p>First we list all the layers in the <a href="../datasets.html" target="_blank">datasets folder</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">## View spatial layers in the data folder</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">st_layers</span>(<span class="st">&quot;./data&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">## Import the &#39;yose_boundary&#39; layer (a Shapefile)</span></a>
<a class="sourceLine" id="cb2-5" title="5">yose_bnd &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn=</span><span class="st">&quot;./data&quot;</span>, <span class="dt">layer=</span><span class="st">&quot;yose_boundary&quot;</span>)</a></code></pre></div>
<pre><code>## Driver: ESRI Shapefile 
## Available layers:
##        layer_name geometry_type features fields
## 1     ca_counties    3D Polygon       58     13
## 2           veg37       Polygon     6512     26
## 3    Yosemite_POI         Point     2720     30
## 4   yose_boundary       Polygon        1     11
## 5 veg37_alliances            NA       39      3</code></pre>
<pre><code>## Reading layer `yose_boundary&#39; from data source `C:\Workshops\R-Spatial\rspatial_mod\outputs\rspatial_scgis19\docs\data&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 11 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -119.8864 ymin: 37.4947 xmax: -119.1964 ymax: 38.18515
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs</code></pre>
<div class="tip">
<p>To view the metadata of a layer before brining it into R, use <tt>rgdal::ogrInfo()</tt></p>
<p>Because Shapefiles only contain one layer, you can combine the source and layer in the <tt>dsn</tt> argument:</p>
<div class="indented1 indented1-r">
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">yose_bnd &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn=</span><span class="st">&quot;./data/yose_boundary.shp&quot;</span>)</a></code></pre></div>
</div>
</div>
<p>See what type of object we just created:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">class</span>(yose_bnd)</a></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>We see that <tt><em>yose_bnd</em></tt> is both a <tt>sf</tt> object as well as a <tt>data.frame</tt>. This means we should be able to use the functions designed for <em>either</em> of those objects.</p>
<div class="tryit">
<p>Type the name of the object at the console.</p>
<div class="indented1 indented1-r">
<div class="sourceCode" id="cb8"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">yose_bnd</a></code></pre></div>
</div>
<p>
What coordinate reference system is it in? <span id="soln_hcsduo" class="showhidesoln" onclick="showHide(&#39;hcsduo&#39;);return false;">[Answer]</span>
</p>
<div id="hcsduo" class="hint">
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">yose_bnd</a></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 11 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -119.8864 ymin: 37.4947 xmax: -119.1964 ymax: 38.18515
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs
##   UNIT_CODE
## 1      YOSE
##                                                                             GIS_NOTES
## 1 Lands - http://landsnet.nps.gov/tractsnet/documents/YOSE/METADATA/yose_metadata.xml
##                UNIT_NAME  DATE_EDIT STATE REGION GNIS_ID     UNIT_TYPE
## 1 Yosemite National Park 2016-01-27    CA     PW  255923 National Park
##   CREATED_BY                                               METADATA
## 1      Lands http://nrdata.nps.gov/programs/Lands/YOSE_METADATA.xml
##   PARKNAME                       geometry
## 1 Yosemite POLYGON ((-119.8456 37.8327...</code></pre>
<p><strong>Ans</strong>. unprojected geographic coordinates (long-lat).</p>
</div>
</div>
<p>The <tt><strong>names()</strong></tt> function returns the column labels of a data frame (in this case the attribute table).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">## View column names in the attribute table</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">names</span>(yose_bnd)</a></code></pre></div>
<pre><code>##  [1] &quot;UNIT_CODE&quot;  &quot;GIS_NOTES&quot;  &quot;UNIT_NAME&quot;  &quot;DATE_EDIT&quot;  &quot;STATE&quot;     
##  [6] &quot;REGION&quot;     &quot;GNIS_ID&quot;    &quot;UNIT_TYPE&quot;  &quot;CREATED_BY&quot; &quot;METADATA&quot;  
## [11] &quot;PARKNAME&quot;   &quot;geometry&quot;</code></pre>
<p>Take note of the last column - <tt>geometry</tt>. That’s where the geometry is saved (we’ll come back to that later).</p>
</div>
<div id="basic-plotting-sf-objects" class="slide section level1">
<h1>Basic plotting sf objects</h1>
<p>To plot just the geometry of a sf object (i.e., no symbology from the attribute table), we can use the <tt>st_geometry()</tt> function.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co">## Plot the geometry (outline) of the Yosemite boundary</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_bnd), <span class="dt">asp=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_importing-vector_files/figure-slidy/plot_yose_bnd-1.png" width="768" /></p>
<div class="tip">
<p>The <tt>asp=1</tt> argument sets the aspect ratio. It is optional but generally a good idea for spatial data.</p>
</div>
</div>
<div id="import-a-kml" class="slide section level1">
<h1>Import a KML</h1>
<p>kml &amp; kmz files can have more than one layer. Hence the source is the kml file, and you must specify the layer by name.</p>
<p>Let’s import a kml containing the <a href="../datasets.html#yose_historic_pts" target="_blank">National Register of Historic Places in Yosemite</a> in Yosemite.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">kml_fn &lt;-<span class="st"> &quot;./data/yose_historic_pts.kml&quot;</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">file.exists</span>(kml_fn)</a>
<a class="sourceLine" id="cb14-3" title="3"></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">## View the layers in this kml</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">st_layers</span>(kml_fn)</a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co">## Import the &#39;yosem_historic_places&#39; layer </span></a>
<a class="sourceLine" id="cb14-8" title="8">yose_hp &lt;-<span class="st"> </span><span class="kw">st_read</span>(kml_fn, <span class="dt">layer=</span><span class="st">&quot;yose_historic_places&quot;</span>)</a>
<a class="sourceLine" id="cb14-9" title="9"></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">## View properties</span></a>
<a class="sourceLine" id="cb14-11" title="11">yose_hp</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<pre><code>## Driver: KML 
## Available layers:
##             layer_name geometry_type features fields
## 1 yose_historic_places         Point       35      2</code></pre>
<pre><code>## Reading layer `yose_historic_places&#39; from data source `C:\Workshops\R-Spatial\rspatial_mod\outputs\rspatial_scgis19\docs\data\yose_historic_pts.kml&#39; using driver `KML&#39;
## Simple feature collection with 35 features and 2 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -119.8447 ymin: 37.51356 xmax: -119.2165 ymax: 38.08368
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<pre><code>## Simple feature collection with 35 features and 2 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -119.8447 ymin: 37.51356 xmax: -119.2165 ymax: 38.08368
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## First 10 features:
##                                  Name Description
## 1  Hetch Hetchy Railroad Engine No. 6            
## 2             Hodgdon Homestead Cabin            
## 3                       Rangers&#39; Club            
## 4                    Buck Creek Cabin            
## 5               Wawona Covered Bridge            
## 6             Crane Flat Fire Lookout            
## 7      Glacier Point Trailside Museum            
## 8                      McCauley Cabin            
## 9                  Bagby Stationhouse            
## 10                  Great Sierra Mine            
##                      geometry
## 1   POINT (-119.786 37.67437)
## 2   POINT (-119.656 37.53924)
## 3  POINT (-119.5883 37.74735)
## 4  POINT (-119.4897 37.56131)
## 5   POINT (-119.656 37.53859)
## 6  POINT (-119.8207 37.75978)
## 7  POINT (-119.5731 37.72916)
## 8  POINT (-119.3676 37.87812)
## 9  POINT (-119.7862 37.67439)
## 10  POINT (-119.2688 37.9276)</code></pre>
<div class="infobox">
<p>Limitations with kml files</p>
<p><strong>kmz</strong> files are simply zipped <strong>kml</strong> files. Unfortunately you can <em>not</em> import a kmz file with <tt>st_read()</tt> (at least not on Windows). Unzip it first (which you can do in R if needed) and then import the <em>doc.kml</em> file.</p>
<p>Unfortunately, <tt>st_read()</tt> can not currently import the attribute table from a kml file on Windows (<a href="https://github.com/r-spatial/sf/issues/499" target="_blank">more info</a>).</p>
<p>☞ Stay away from kml/kmz files if possible!</p>
</div>
</div>
<div id="plotting-multiple-layers" class="slide section level1">
<h1>Plotting multiple layers</h1>
<p>To overlay more than one layer on a plot:</p>
<div class="indented1">
<ul>
<li>both layers must have the same CRS (<tt>plot()</tt> does not reproject on the fly)<br />
</li>
<li>include <tt>add=TRUE</tt> to the plot statements</li>
</ul>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co">## Plot the boundary</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_bnd), <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">## Add historic places</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_hp), <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="04_importing-vector_files/figure-slidy/plot_ynp_hp_klippy-1.png" width="768" /></p>
</div>
<div id="import-a-geojson-file" class="slide section level1">
<h1>Import a GeoJSON file</h1>
<p><a href="https://geojson.org" target="_blank">GeoJSON</a> is a good alternative to the Shapefile and KML formats. GeoJSON is one file that can store one vector layer in an open format that can be read in a text editor.</p>
<p>Import the California county boundaries, which is saved as a GeoJSON file.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">counties_fn &lt;-<span class="st"> &quot;./data/ca_counties.geojson&quot;</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">file.exists</span>(counties_fn)</a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="co">## View the layers </span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="kw">st_layers</span>(counties_fn)</a>
<a class="sourceLine" id="cb20-6" title="6"></a>
<a class="sourceLine" id="cb20-7" title="7"><span class="co">## Import the &#39;yosem_historic_places&#39; layer </span></a>
<a class="sourceLine" id="cb20-8" title="8">ca_counties_ll &lt;-<span class="st"> </span><span class="kw">st_read</span>(counties_fn)</a>
<a class="sourceLine" id="cb20-9" title="9"></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="co">## Plot</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(ca_counties_ll), <span class="dt">asp=</span><span class="dv">1</span>, <span class="dt">axes=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Driver: GeoJSON 
## Available layers:
##    layer_name    geometry_type features fields
## 1 ca_counties 3D Multi Polygon       58     13</code></pre>
<pre><code>## Reading layer `ca_counties&#39; from data source `C:\Workshops\R-Spatial\rspatial_mod\outputs\rspatial_scgis19\docs\data\ca_counties.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 58 features and 13 fields
## geometry type:  MULTIPOLYGON
## dimension:      XYZ
## bbox:           xmin: -124.4096 ymin: 32.53416 xmax: -114.1312 ymax: 42.00952
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p><img src="04_importing-vector_files/figure-slidy/imp_counties_exec-1.png" width="768" /></p>
</div>
<div id="import-from-a-geodatabase" class="slide section level1">
<h1>Import from a Geodatabase</h1>
<p>You can import (but not write to) an ESRI <strong>file geodatabase</strong> using the <strong>sf</strong> package. In this case, the source is the folder containing the geodatabase.</p>
<p>Let’s import the <a href="../datasets.html#yose_trails">Yosemite’s trails</a> from a geodatabase.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co">## Define the path to the file geodatabase (a folder)</span></a>
<a class="sourceLine" id="cb23-2" title="2">gdb_fn &lt;-<span class="st"> &quot;./data/yose_trails.gdb&quot;</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="kw">file.exists</span>(gdb_fn)</a>
<a class="sourceLine" id="cb23-4" title="4"></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="co">## View the layers in this source</span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="kw">st_layers</span>(gdb_fn)</a>
<a class="sourceLine" id="cb23-7" title="7"></a>
<a class="sourceLine" id="cb23-8" title="8"><span class="co">## Import the &#39;Trails&#39; layer  (case sensitive!)</span></a>
<a class="sourceLine" id="cb23-9" title="9">yose_trails &lt;-<span class="st"> </span><span class="kw">st_read</span>(gdb_fn, <span class="dt">layer=</span><span class="st">&quot;Trails&quot;</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<pre><code>## Driver: OpenFileGDB 
## Available layers:
##                layer_name     geometry_type features fields
## 1              Trailheads             Point       73      5
## 2                  Trails Multi Line String     1074     13
## 3 Wilderness_stock_routes Multi Line String       11      6
## 4           Winter_trails Multi Line String       24      5
## 5          T_1_DirtyAreas     Multi Polygon        1      3
## 6         T_1_PointErrors             Point      260      7
## 7          T_1_LineErrors Multi Line String        0      8
## 8          T_1_PolyErrors     Multi Polygon        0      9</code></pre>
<pre><code>## Reading layer `Trails&#39; from data source `C:\Workshops\R-Spatial\rspatial_mod\outputs\rspatial_scgis19\docs\data\yose_trails.gdb&#39; using driver `OpenFileGDB&#39;
## Simple feature collection with 1074 features and 13 fields
## geometry type:  MULTILINESTRING
## dimension:      XY
## bbox:           xmin: 245134 ymin: 4153668 xmax: 323239.7 ymax: 4250703
## epsg (SRID):    26911
## proj4string:    +proj=utm +zone=11 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<div class="infobox">
<p>You can <em>write</em> to a geodatabase with the R-ArcGIS Bridge, if you have licensed copy of ArcGIS installed.</p>
<p>Open source equivalents of ERSI’s propietary Geodatabase format include <a href="https://www.geopackage.org/" target="_blank">GeoPackage</a>, <a href="https://postgis.net/" target="_blank">PostGIS</a>, and <a href="https://en.wikipedia.org/wiki/SpatiaLite" target="_blank">SpatiaLite</a>.</p>
</div>
<h2 id="plot-yosemites-trails">Plot Yosemite’s Trails</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co">## Plot the trails layer</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_trails), <span class="dt">axes=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="04_importing-vector_files/figure-slidy/plot_trails_klippy-1.png" width="768" /></p>
<div class="tryit">
<p>The following code does <strong>not</strong> work to make a plot of the park boundary and the trails. Can you tell why?</p>
<div class="indented1 indented1-r">
<div class="sourceCode" id="cb28"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_bnd))</a>
<a class="sourceLine" id="cb28-2" title="2"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_trails), <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<p><span id="soln_bhgkbo" class="showhidesoln" onclick="showHide(&#39;bhgkbo&#39;);return false;">[Answer]</span></p>
<div id="bhgkbo" class="hint">
<p>Because they’re in different projections! We’ll deal with that soon.</p>
</div>
</div>
</div>
<div id="import-from-a-geopackage" class="slide section level1">
<h1>Import from a GeoPackage</h1>
<p><img src="images/geopkg200x150.png" style="float:right;"/></p>
<p><a href="https://www.geopackage.org/" target="_blank">GeoPackage</a> is a relatively new open format for geospatial data. It is <strong>similar</strong> to a file geodatabase in that:</p>
<div class="indented2">
<ul>
<li>it can contain many layers<br />
</li>
<li>supports both raster and vector data<br />
</li>
<li>under the hood data are stored in a spatial database</li>
</ul>
</div>
<p>The GeoPackage is <strong>different</strong> from a file geodatabase in that GeoPackages are:</p>
<div class="indented2">
<ul>
<li>a single file disk with a .gpkg extension (as opposed to a directory)<br />
</li>
<li>completely open source following a <a href="http://www.opengeospatial.org/" target="_blank">OGC</a> standard<br />
</li>
<li>based on SQLite instead of a proprietary database format<br />
</li>
<li>cross-platform</li>
</ul>
</div>
<p>You import from a GeoPackage using the same functions as any other vector layer: <tt>st_layers()</tt> and <tt>st_read()</tt>.</p>
<p>Let’s import <a href="../datasets.html#yose_watersheds">Yosemite’s watersheds</a> from a geopackage.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r klippy copyme"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co">## Import watersheds</span></a>
<a class="sourceLine" id="cb29-2" title="2">gpkg_watershd_fn &lt;-<span class="st"> &quot;./data/yose_watersheds.gpkg&quot;</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="kw">file.exists</span>(gpkg_watershd_fn)</a>
<a class="sourceLine" id="cb29-4" title="4"><span class="kw">st_layers</span>(gpkg_watershd_fn)</a>
<a class="sourceLine" id="cb29-5" title="5">yose_watersheds &lt;-<span class="st"> </span><span class="kw">st_read</span>(gpkg_watershd_fn, <span class="dt">layer=</span><span class="st">&quot;calw221&quot;</span>)</a>
<a class="sourceLine" id="cb29-6" title="6"></a>
<a class="sourceLine" id="cb29-7" title="7"><span class="co">## Plot it</span></a>
<a class="sourceLine" id="cb29-8" title="8"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(yose_watersheds), <span class="dt">axes=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Driver: GPKG 
## Available layers:
##   layer_name geometry_type features fields
## 1    calw221       Polygon      127     38</code></pre>
<pre><code>## Reading layer `calw221&#39; from data source `C:\Workshops\R-Spatial\rspatial_mod\outputs\rspatial_scgis19\docs\data\yose_watersheds.gpkg&#39; using driver `GPKG&#39;
## Simple feature collection with 127 features and 38 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 1383.82 ymin: -61442.93 xmax: 81596.71 ymax: 26405.66
## epsg (SRID):    NA
## proj4string:    +proj=aea +lat_1=34 +lat_2=40.5 +lat_0=0 +lon_0=-120 +x_0=0 +y_0=-4000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</code></pre>
<p><img src="04_importing-vector_files/figure-slidy/import_watersheds_exec-1.png" width="768" /></p>
<div class="tryit">
<p>What CRS are the Yosemite watersheds in?</p>
<p>[<span id="soln_tvzbct" class="showhidesoln" onclick="showHide(&#39;tvzbct&#39;);return false;">Answer</span>]</p>
<div id="tvzbct" class="hint">
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">yose_watersheds</a></code></pre></div>
<pre><code>## Simple feature collection with 127 features and 38 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 1383.82 ymin: -61442.93 xmax: 81596.71 ymax: 26405.66
## epsg (SRID):    NA
## proj4string:    +proj=aea +lat_1=34 +lat_2=40.5 +lat_0=0 +lon_0=-120 +x_0=0 +y_0=-4000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
## First 10 features:
##        CALWNUM SWRCBNUM21 HRC HBPA  RBU  RBUA  RBUAS   RBUASP    RBUASPW
## 1  8631.400101     631.40  NL   NL 8631 86314 863140 86314001 8631400101
## 2  8630.400204     630.40  NL   NL 8630 86304 863040 86304002 8630400204
## 3  8631.400104     631.40  NL   NL 8631 86314 863140 86314001 8631400104
## 4  6536.510101     536.51  SJ   SJ 6536 65365 653651 65365101 6536510101
## 5  6536.600801     536.60  SJ   SJ 6536 65366 653660 65366008 6536600801
## 6  8630.400301     630.40  NL   NL 8630 86304 863040 86304003 8630400301
## 7  8630.400302     630.40  NL   NL 8630 86304 863040 86304003 8630400302
## 8  8630.400400     630.40  NL   NL 8630 86304 863040 86304004 8630400400
## 9  8630.400306     630.40  NL   NL 8630 86304 863040 86304003 8630400306
## 10 6536.600701     536.60  SJ   SJ 6536 65366 653660 65366007 6536600701
##    HR RB HU HA HSA SPWS PWS         HRNAME         RBNAME       HBPANAME
## 1   8  6 31  4   0    1   1 North Lahontan       Lahontan North Lahontan
## 2   8  6 30  4   0    2   4 North Lahontan       Lahontan North Lahontan
## 3   8  6 31  4   0    1   4 North Lahontan       Lahontan North Lahontan
## 4   6  5 36  5   1    1   1    San Joaquin Central Valley    San Joaquin
## 5   6  5 36  6   0    8   1    San Joaquin Central Valley    San Joaquin
## 6   8  6 30  4   0    3   1 North Lahontan       Lahontan North Lahontan
## 7   8  6 30  4   0    3   2 North Lahontan       Lahontan North Lahontan
## 8   8  6 30  4   0    4   0 North Lahontan       Lahontan North Lahontan
## 9   8  6 30  4   0    3   6 North Lahontan       Lahontan North Lahontan
## 10  6  5 36  6   0    7   1    San Joaquin Central Valley    San Joaquin
##               HUNAME                  HANAME     HSANAME
## 1  WEST WALKER RIVER Upper West Walker River   undefined
## 2  EAST WALKER RIVER East Walker Tributaries   undefined
## 3  WEST WALKER RIVER Upper West Walker River   undefined
## 4     TUOLUMNE RIVER            Cherry Creek Mercut Peak
## 5     TUOLUMNE RIVER            Hetch Hetchy   undefined
## 6  EAST WALKER RIVER East Walker Tributaries   undefined
## 7  EAST WALKER RIVER East Walker Tributaries   undefined
## 8  EAST WALKER RIVER East Walker Tributaries   undefined
## 9  EAST WALKER RIVER East Walker Tributaries   undefined
## 10    TUOLUMNE RIVER            Hetch Hetchy   undefined
##                      CDFSPWNAME             CDFPWSNAME    ACRES    HUC_8
## 1  Headwaters West Walker River          Cascade Creek  6083.05 16050302
## 2                 Buckeye Creek    Upper Buckeye Creek  9890.68 16050301
## 3  Headwaters West Walker River         Kirkwood Creek  6770.62 16050302
## 4              Huckleberry Lake East Fork Cherry Creek 12641.80 18040009
## 5                   Falls Creek Upper Jack Main Canyon  8838.88 18040009
## 6                    Twin Lakes            Horse Creek  7698.36 16050301
## 7                    Twin Lakes           Cattle Creek 10778.60 16050301
## 8                   Green Creek              undefined 12459.80 16050301
## 9                    Twin Lakes    Little Slide Canyon  6099.80 16050301
## 10              Rancheria Creek        Thompson Canyon  9108.38 18040009
##           HUC_8_NAME HUC_8_ALT2 HUC_8_ALT3    DWRNUM20         DWRHUNAME
## 1  WEST_WALKER-CA,NV          0          0 8631.400101 WEST WALKER RIVER
## 2  EAST_WALKER-CA,NV          0          0 8630.400204 EAST WALKER RIVER
## 3  WEST_WALKER-CA,NV          0          0 8631.400104 WEST WALKER RIVER
## 4     UPPER_TUOLUMNE          0          0 6536.510101    TUOLUMNE RIVER
## 5     UPPER_TUOLUMNE          0          0 6536.600801    TUOLUMNE RIVER
## 6  EAST_WALKER-CA,NV          0          0 8630.400301 EAST WALKER RIVER
## 7  EAST_WALKER-CA,NV          0          0 8630.400302 EAST WALKER RIVER
## 8  EAST_WALKER-CA,NV          0          0 8630.400400 EAST WALKER RIVER
## 9  EAST_WALKER-CA,NV          0          0 8630.400306 EAST WALKER RIVER
## 10    UPPER_TUOLUMNE          0          0 6536.600701    TUOLUMNE RIVER
##                  DWRHANAME  DWRHSANAME    CDFNUM22 CASE_ RuleID Shape_Leng
## 1  Upper West Walker River   undefined 8631.400101  6043     11   30867.64
## 2  East Walker Tributaries   undefined 8630.400204  6022     10   29692.64
## 3  Upper West Walker River   undefined 8631.400104  6046     11   25629.17
## 4             Cherry Creek Mercut Peak 6536.510101  4765    104   55741.97
## 5             Hetch Hetchy   undefined 6536.600801  4815    104   31653.39
## 6  East Walker Tributaries   undefined 8630.400301  6023     10   31428.37
## 7  East Walker Tributaries   undefined 8630.400302  6024     10   29562.53
## 8  East Walker Tributaries   undefined 8630.400400  6029     10   48098.49
## 9  East Walker Tributaries   undefined 8630.400306  6028     10   27669.78
## 10            Hetch Hetchy   undefined 6536.600701  4807    104   35837.74
##    Shape_Area                           geom
## 1    24617751 POLYGON ((39955.35 26405.66...
## 2    40027025 POLYGON ((48360.46 21410.36...
## 3    27400329 POLYGON ((41178.45 21036.4,...
## 4    51160710 POLYGON ((32269.54 20892.96...
## 5    35770470 POLYGON ((35285.94 18614.35...
## 6    31154844 POLYGON ((51733.02 18347.97...
## 7    43620499 POLYGON ((55936.4 18119.57,...
## 8    50424283 POLYGON ((66834.96 17741.56...
## 9    24685535 POLYGON ((50494.98 16876.24...
## 10   36861121 POLYGON ((43466.39 15993.69...</code></pre>
<p>Ans. California Equal Albers (a common projection for statewide data in California)</p>
</div>
</div>
</div>
<div id="exercise" class="slide section level1">
<h1>Exercise</h1>
<p>Look at the other GIS files in the workshop <a href="../datasets.html" target="_blank">data folder</a>. Select one, import it, and plot it.</p>
</div>
<div id="summary" class="slide section level1">
<h1>Summary</h1>
<p>We just saw how to:</p>
<div class="compact">
<ul>
<li>import from Shapefiles, KMLs, ESRI file geodatabases, and GeoPackages
<ul>
<li><tt>st_layers()</tt> views the layer names<br />
</li>
<li><tt>st_read()</tt> imports the layer<br />
</li>
</ul></li>
<li>use <tt>plot()</tt> for basic plotting</li>
<li>use <tt>plot(…, add=TRUE)</tt> to overlay additional layers with the same CRS</li>
</ul>
</div>
<div class="infobox">
<p>Additional Resources</p>
<div class="indented1">
<p><a href="http://zevross.com/blog/2016/01/13/tips-for-reading-spatial-files-into-r-with-rgdal/" target="_blank">Importing spatial data with <tt>rgdal</tt></a>, by Zev Ross</p>
<p><a href="https://r-spatial.github.io/sf/articles/sf5.html" target="_blank">Plotting Simple Features</a>, sf package Vignette</p>
</div>
</div>
<p>
<strong>Next: </strong> <a href="05_plotting-vector.html">Visualization Part II</a>
</p>
</div>

  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

</body>
</html>
